{%- comment -%} ✅ DRAWER AJUSTÉ {%- endcomment -%}
    <div 
  class="fixed inset-0 z-50 bg-black bg-opacity-50 transition-opacity"
  x-show="$store.cart.drawerOpen"
  x-cloak
  x-transition.opacity 
  @click.away="drawerOpen = false"
>
  <div 
    class="drawer absolute top-0 right-0 lg:right-8 lg:top-8 lg:bottom-8 w-full lg:w-1/3 p-6 flex flex-col justify-between z-20 rounded-xl bg-white"
    x-show="$store.cart.drawerOpen"
    x-cloak
    x-transition:enter="transition transform duration-300"
    x-transition:enter-start="translate-x-full"
    x-transition:enter-end="translate-x-0"
    x-transition:leave="transition transform duration-200"
    x-transition:leave-start="translate-x-0"
    x-transition:leave-end="translate-x-full"
  >
    <!-- Header du panier -->
    <div class="drawer__head flex flex-col gap-4">
      <div class="flex w-full justify-between items-center">
        <div class="flex flex-row gap-3 items-center">
          <h3 class="heading-md text-primary">Panier</h3>
          <span class="body-sm text-secondary" x-text="$store.cart.cart?.item_count + ' article(s)'"></span>
        </div>
        <button class="button-icon button-icon--link" @click="$store.cart.drawerOpen = false">
          <img src="{{ 'cross-black.static.svg' | asset_url }}" alt="Fermer" class="w-6 h-6" width="24" height="24">
        </button>
      </div>
      <div class="divider"></div>
      {% assign carousel_texts = product.metafields.custom.carousel_texts.value %}
        {% if carousel_texts != blank and carousel_texts.size > 0 %}
        <div class="text-carousel swiper my-text-swiper w-full flex justify-between gap-2 items-center">
        <div class="swiper-wrapper w-[80%]">
            {% for text in carousel_texts %}
            <div class="swiper-slide text-secondary body-md">
                {{ text }}
            </div>
            {% endfor %}
        </div>
        {% if carousel_texts.size > 1 %}
            <div class="swiper-pagination w-[20%] flex justify-end"></div>
        {% endif %}
        </div>
        {% endif %}
        <div class="divider"></div>

      <!-- Éléments du panier -->
      <template x-if="$store.cart.cart && $store.cart.cart.items.length > 0">
        <div class="flex flex-col gap-6 max-h-[60vh] overflow-y-auto pr-2">
          <template x-for="item in $store.cart.cart.items" :key="item.key">
            <div class="flex gap-4 items-start">
              <img :src="item.image" class="w-20 h-20 object-cover rounded-xl" width="80" height="80" />

              <div class="flex flex-col justify-between flex-1">
                <div class="flex justify-between gap-8">
                  <p class="body-sm text-primary" x-text="item.product_title"></p>
                  <p class="body-sm text-primary whitespace-nowrap" x-text="(item.price * item.quantity) / 100 + ' €'"></p>
                </div>

                <div class="flex justify-between items-center gap-4 mt-2">
                  <select
                    class="body-sm border rounded px-2 py-1"
                    x-model="item.quantity"
                    @change="
                    $store.cart.loading = true;
                    fetch('/cart/change.js', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ id: item.key, quantity: parseInt($event.target.value) })
                    })
                    .then(() => fetch('/cart.js'))
                    .then(res => res.json())
                    .then(data => {
                        $store.cart.cart = data;
                        $store.toast.showToast('Quantité mise à jour');
                        $store.cart.loading = false;
                    })
                    "
                  >
                    <template x-for="n in 10">
                      <option :value="n" x-text="n"></option>
                    </template>
                  </select>

                  <button
                    class="button-icon button-icon--link"
                    @click="
                    $store.cart.loading = true;
                    fetch('/cart/change.js', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ id: item.key, quantity: 0 })
                    })
                    .then(() => fetch('/cart.js'))
                    .then(res => res.json())
                    .then(data => {
                        $store.cart.cart = data;
                        $store.toast.showToast('Produit supprimé du panier');
                        $store.cart.loading = false;
                    })
                    "
                    >
                    <img src="{{ 'cross-black.static.svg' | asset_url }}" alt="Supprimer" class="w-6 h-6" width="24" height="24">
                    </button>
                </div>
              </div>
            </div>
          </template>
        </div>
      </template>

      <!-- Panier vide -->
      <template x-if="$store.cart.cart && $store.cart.cart.items.length === 0">
        <div class="text-center py-12">
          <p class="text-secondary body-sm">Votre panier est vide !</p>
        </div>
      </template>
    </div>

    <template x-if="$store.cart.loading">
        <div class="flex justify-center py-8">
            <svg class="animate-spin w-6 h-6 text-primary" viewBox="0 0 24 24" fill="none">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" />
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v8H4z" />
            </svg>
        </div>
    </template>

    <!-- Footer -->
    <div>
        <div class="divider my-4"></div>
        <a href="/checkout" class="button button--primary" x-show="$store.cart.cart?.items?.length > 0">
            Finaliser la commande
            <img src="{{ 'check-filled-white.static.svg' | asset_url }}" alt="Icone check" class="w-6 h-6" width="24" height="24">
        </a>
    </div>
  </div>
</div>